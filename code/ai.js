

import { okResponse } from './lib/constants.js'
import { mustBePOST, mustBeJSON, apiKey, handleCORS } from './lib/checks.js'

const MODEL = '@cf/meta/llama-4-scout-17b-16e-instruct'
const MAX_TOKENS = 512
const PROMPT = `
Please summarise the following text as a JSON object with the following attributes:
- title: the title of the TV programme.
- description: a brief synopsis.
- stars: an array of strings containing up to five cast members, with no duplicates.
- on: the channel it is broadcast on in the UK - one of 'BBC','ITV','Channel4','Channel5','Netflix','AppleTV','Disney','Amazon','SkyAtlantic','Alba','Paramount','U'
- date: an ISO-8601 string representing the date of first broadcast in the UK.
- type: either "film" for a movie, "series" for a series and "oneoff" for everything else.
- uptomax: the number of episodes, if the type is a "series".
Please return a JSON object and nothing else.
`

export async function onRequest(context) {
  // handle POST/JSON/apikey chcecks
  const r = handleCORS(context.request) || apiKey(context.request, context.env) || mustBePOST(context.request) || mustBeJSON(context.request)
  if (r) return r
  
  const txt = `
  Going Out Holidays Money RT shop RT puzzles Newsletters Download our app TV Guide Back to Main menu On TV now On TV tonight On streaming TV Back to Main menu What to watch Back to TV Best shows on Netflix Best shows in iPlayer Best shows on Disney+ Best shows on Prime Video Streaming guide Back to TV Apple TV+ Disney+ Netflix NOW Prime Video Paramount+ TV by genre Back to TV Drama Comedy Documentaries Entertainment Sci-Fi Fantasy Popular TV Back to TV Doctor Who Walking with Dinosaurs Clarkson's Farm Race Across the World The Last of Us MobLand The Chelsea Detective Death Valley Nine Perfect Strangers The Royals Forever Sport on TV Back to TV Live sports Football Cricket Tennis All sports Soaps Back to Main menu Coronation Street EastEnders Emmerdale All soaps Film Back to Main menu Vue Pass for RadioTimes.com Gaming Magazine More Back to Main menu Radio listings Audio RT podcasts Radio news The Best Ever Technology Tech guides Going Out Books Subscribe Going Out Holidays Money RT shop RT puzzles Newsletters Download our app Search Home TV Drama The Bombing of Pan Am 103 Lockerbie drama tells stories which haven't been heard before, says boss The Bombing of Pan Am 103 Lockerbie drama tells stories which haven't been heard before, says boss "There was a whole scale of investigation that had been overlooked, and it felt like it was a story that needed to be told." BBC/World Productions James Hibbs Published: Saturday, 17 May 2025 at 10:46 am Subscribe to Radio Times magazine and get 10 issues for £10 Share on facebook Share on twitter Share on pinterest Share on reddit Email to a friend New drama The Bombing of Pan Am 103 tells the true story surrounding the aftermath of the 1988 Lockerbie bombing, and has been produced as a collaboration between the BBC, Netflix, MGM and World Productions. Ad Simon Heath, CEO and creative director of World Productions, which has also been behind shows such as Line of Duty and Vigil , recently opened up about the drama when speaking at a Q&A, saying it was a "drama that needed to be seen". He said: "I read the pilot, I think it was in 2021. And I thought I knew a reasonable amount about the Lockerbie story, and realised reading just the first script, and then Adam [Morane-Griffiths, executive producer]'s brilliant research document, that I didn't. "There was an awful lot more to this story. There were voices that hadn't been heard, there were stories that hadn't been told. There was a whole scale of investigation that had been overlooked, and it felt like it was a story that needed to be told and a drama that needed to be seen." The Bombing of Pan Am 103. BBC/World Productions The series features an ensemble cast led by Connor Swindells and Patrick J Adams, and follows a number of real-life figures whose stories have been dramatised, including their characters police officer Ed McCusker and FBI special agent Dick Marquise . Read more: Baptiste and Good Omens stars join Suranne Jones and Jodie Whittaker's new ITV drama Malpractice and The Night Manager stars in first look at Luther creator's new thriller The Iris Affair Heath also spoke about why the project needed to be a collaboration between so many partners, saying: "There was a challenge of finding the home for the project. "I knew the BBC had had a number of Lockerbie projects in development over the last 20 years, and so what I was banking on was that they would have the same response as me, which ‘This is a unique angle. These are stories that haven't been told.’ "And fortunately, when Gaynor Holmes at BBC Scotland read the script, she felt the same way. And it felt like a script that went through the BBC very, very quickly. Everyone read it, recognised the importance of the story, recognised that the timing was right, that the angle on the story was right, and that it's something that should get made. "So we got the BBC on board, and then the scale of this kind of drama needs big resources. It needs international backing. It can't just be UK. And fortunately, I knew the team at Netflix very well, Anne Mensah, Mona Qureshi, Manda Levin, and they all responded really quickly to the story as well, and came on board as our partners. "It's a pretty unique collaboration between MGM, BBC, Netflix and us [World Productions], but it's needed that scale of production to bring it to the screen." Be the first to get the latest drama news, direct to your inbox Keep up to date with all the dramas - from period to crime to comedy Email address Sign Up By entering your details you are agreeing to our terms and conditions and privacy policy . You can unsubscribe at any time. This site is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply. The Lockerbie bombing, which saw a plane en route from Heathrow to JFK being bombed, was the worst ever terror attack on British soil and the first major act of terrorism against US citizens, and left 270 people dead. The series follows the story of the Scots-US investigation into the attack and the devastating effect it had on the small town and the families who lost loved ones. The Bombing of Pan Am 103 premieres on BBC One and iPlayer on Sunday 18th May, with new episodes premiering at 9pm every Sunday and Monday for three weeks. Ad Check out more of our Drama coverage or visit our TV Guide and Streaming Guide to find out what's on. For more from the biggest stars in TV, listen to The Radio Times Podcast . Authors James Hibbs Drama Writer James Hibbs is a Drama Writer for Radio Times, covering programmes across both streaming platforms and linear channels. He previously worked in PR, first for a B2B agency and subsequently for international TV production company Fremantle. He possesses a BA in English and Theatre Studies and an NCTJ Level 5 Diploma in Journalism. Visit us on Twitter Ad Ad Ad The best TV and entertainment news in your inbox Sign up to receive our newsletter! Email address Sign Up By entering your details, you are agreeing to site title privacy policy. You can unsubscribe at any time. This site is protected by reCAPTCHA and the Google Privacy Policy and Terms of Service apply. Subscribe to RT! Subscribe to Radio Times magazine and get £10 issues for £10! Get the offer Am I eligible for equity release? Firstly, you must own the home you wish to release equity from, and it must be worth at least £70,000. FIND OUT MORE Travel insurance Compare quotes and see if you could get cheaper travel insurance. GET QUOTES Visit us on Facebook Visit us on Twitter Visit us on Instagram Visit us on Pinterest Visit us on Youtube Visit us on Tiktok Visit us on Rss Privacy & Cookies Terms & Conditions Code of Conduct Advertise Complaints About Us Contact Us Manage Privacy Settings Website is owned and published by Immediate Media Company Limited. www.immediatemedia.co.uk © Immediate 2025 GoodFood.com olivemagazine.com GardenersWorld.com MadeforMums.com HistoryExtra.com TheRecommended.com RadioTimesMoney.com RadioTimesPuzzles.com TV listings TV Streaming What to Watch Drama Comedy Soaps Anime Entertainment Fantasy Sci-fi Doctor Who Film Marvel Star Wars Fast and Furious Netflix Disney+ Sport Football Rugby union Cricket Formula 1 Boxing Gaming Upcoming games Technology Tech guides Magazine Radio The Best Ever Going Out Quizzes Podcast Subscribe Radio listings 
  `


  const response = await context.env.AI.run(MODEL, {
    stream: false,
    max_tokens: MAX_TOKENS,
    messages: [
      { role: "user", content: `${PROMPT} ---- ${txt}` }
    ]
  })
  const obj = {
    ok: true,
    response
  }

  // send response
  return new Response(JSON.stringify(obj), okResponse)
}
